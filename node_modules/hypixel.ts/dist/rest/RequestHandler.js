"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RequestHandler = void 0;
const async_queue_1 = require("@sapphire/async-queue");
const _1 = require(".");
class RequestHandler {
    manager;
    queue;
    constructor(manager) {
        this.manager = manager;
        this.queue = new async_queue_1.AsyncQueue();
    }
    async push(request) {
        await this.queue.wait();
        try {
            return await this.execute(request);
        }
        finally {
            this.queue.shift();
        }
    }
    async execute(request) {
        const res = await request.make();
        if (res.statusCode <= 400)
            return res.body.json();
        const apiError = (await res.body.json());
        throw new _1.HypixelAPIError(apiError.cause, res.statusCode);
    }
}
exports.RequestHandler = RequestHandler;
//# sourceMappingURL=RequestHandler.js.map